<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>I.A-Sarah Frontend</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        h1 { color: #333; }
        section { margin-bottom: 2rem; }
        input, button { padding: 0.4rem; margin-right: 0.5rem; }
        pre { background: #f0f0f0; padding: 1rem; }
        table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
        th, td { border: 1px solid #ccc; padding: 0.4rem; text-align: left; }
        dialog { border: none; padding: 1rem; border-radius: 4px; }
        dialog::backdrop { background: rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <h1>Teste da API I.A-Sarah</h1>

    <section>
        <h2>Alunos</h2>
        <button id="btn-new-student">Novo aluno</button>
        <button id="load-students">Listar alunos</button>
        <table id="students-table"></table>
    </section>

    <dialog id="student-modal">
        <form id="student-form" method="dialog">
            <input type="text" id="modal-nome" placeholder="Nome" required>
            <input type="email" id="modal-email" placeholder="Email" required>
            <input type="hidden" id="modal-id">
            <button type="submit">Salvar</button>
            <button type="button" id="modal-cancel">Cancelar</button>
        </form>
    </dialog>

    <section>
        <h2>Tema</h2>
        <button id="load-theme">Carregar tema</button>
        <button id="set-light">Claro</button>
        <button id="set-dark">Escuro</button>
        <pre id="theme-output"></pre>
    </section>

    <section>
        <h2>Configurações</h2>
        <button id="load-config">Carregar configurações</button>
        <form id="update-config-form" style="margin-top:1rem;">
            <input type="text" id="config-json" size="40" placeholder='{"chave":"valor"}'>
            <button type="submit">Atualizar</button>
        </form>
        <pre id="config-output"></pre>
    </section>

    <section>
        <h2>Estatísticas</h2>
        <button id="load-stats">Carregar estatísticas</button>
        <pre id="stats-output"></pre>
    </section>

<script>
const API = 'http://localhost:8001';

const modal = document.getElementById('student-modal');
const form = document.getElementById('student-form');
const table = document.getElementById('students-table');

function openModal(student = null) {
    if (student) {
        document.getElementById('modal-id').value = student.id;
        document.getElementById('modal-nome').value = student.nome;
        document.getElementById('modal-email').value = student.email;
    } else {
        form.reset();
        document.getElementById('modal-id').value = '';
    }
    modal.showModal();
}

async function loadStudents() {
    const res = await fetch(`${API}/students`);
    const data = await res.json();
    renderTable(data);
}

function renderTable(data) {
    table.innerHTML = '<tr><th>Nome</th><th>Email</th><th>Ações</th></tr>';
    for (const aluno of data) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${aluno.nome}</td><td>${aluno.email}</td>`;
        const actions = document.createElement('td');
        const btnEdit = document.createElement('button');
        btnEdit.textContent = 'Editar';
        btnEdit.onclick = () => openModal(aluno);
        actions.appendChild(btnEdit);
        tr.appendChild(actions);
        table.appendChild(tr);
    }
}

document.getElementById('btn-new-student').addEventListener('click', () => openModal());
document.getElementById('load-students').addEventListener('click', loadStudents);

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = document.getElementById('modal-id').value;
    const nome = document.getElementById('modal-nome').value;
    const email = document.getElementById('modal-email').value;
    const payload = { nome, email };
    if (id) {
        await fetch(`${API}/students/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
    } else {
        await fetch(`${API}/students`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
    }
    modal.close();
    loadStudents();
});

document.getElementById('modal-cancel').addEventListener('click', () => modal.close());

async function loadTheme() {
    const res = await fetch(`${API}/theme`);
    const data = await res.json();
    document.getElementById('theme-output').textContent = JSON.stringify(data, null, 2);
}

document.getElementById('load-theme').addEventListener('click', loadTheme);

document.getElementById('set-light').addEventListener('click', async () => {
    await fetch(`${API}/theme`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ theme: 'light' })
    });
    loadTheme();
});

document.getElementById('set-dark').addEventListener('click', async () => {
    await fetch(`${API}/theme`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ theme: 'dark' })
    });
    loadTheme();
});

async function loadConfig() {
    const res = await fetch(`${API}/config`);
    const data = await res.json();
    document.getElementById('config-output').textContent = JSON.stringify(data, null, 2);
}

document.getElementById('load-config').addEventListener('click', loadConfig);

document.getElementById('update-config-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const json = document.getElementById('config-json').value;
    try {
        const data = JSON.parse(json);
        await fetch(`${API}/config`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        loadConfig();
    } catch(err) {
        alert('JSON inválido');
    }
});

async function loadStats() {
    const res = await fetch(`${API}/stats`);
    const data = await res.json();
    document.getElementById('stats-output').textContent = JSON.stringify(data, null, 2);
}

document.getElementById('load-stats').addEventListener('click', loadStats);
</script>
</body>
</html>
